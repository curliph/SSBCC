<html>
<title>
Memory Initialization
</title>
<body>
This file describes the contents of the memory intialization file and how to
use it for various vendor-specific tools.
<h1>Format</h1>
  Each line of the file consists of a hex address into which the values are to
  be stored and the corresponding value.  For SSBCC.9x8 these are 9-bit
  values.<br/><br/>
  The format of each line is "<tt>@%04X %03X</tt>" where the 4-digit value is
  the hex memory address and the 3-digit hex value is the 9-bit memory
  value.<br/><br/>
<h1>Xilinx <tt>data2mem</tt></h1>
  <tt>data2mem</tt> is a tool for modifying the block ram initialization
  contents of bitstreams.  Using this tool allows the micro controller assembly
  code to be modified in the bitstream without rerunning the entire build
  process.<br/><br/>
  The following illustrates how to use <tt>data2mem</tt> using
  ISE&nbsp;14.5:<br/><br/>
  <ol>
  <li>Create a <tt>BMM</tt> file named "<tt>uc.bmm</tt>" for inclusion in the
    build process:<br/><br/>
    The file should look like the following.  The text
    "<tt>top_inst/uc_inst</tt>" needs to be modified to point to your
    instantiation of the micro controller.  Sometimes
    "<tt>uc_inst/Mram_s_opcodeMemory</tt>" becomes
    "<tt>uc_inst_Mram_s_opcodeMemory</tt>"<br/><br/>
    <tt>ADDRESS_SPACE&nbsp;uc&nbsp;RAMB18&nbsp;WORD_ADDRESSING&nbsp;[0x0:0x7FF]<br/>
    &nbsp;&nbsp;BUS_BLOCK<br/>
    &nbsp;&nbsp;&nbsp;&nbsp;top_inst/uc_inst/Mram_s_opcodeMemory&nbsp;[0:8];<br/>
    &nbsp;&nbsp;END_BUS_BLOCK;<br/>
    END_ADDRESS_SPACE;<br/></tt><br/>
    The following command can be used to verify the syntax of this <tt>BMM</tt>
    file:<br/><br/>
    <tt>&nbsp;&nbsp;data2mem&nbsp;uc_bmm<br/></tt><br/>
    WARNING:  Using "<tt>ARCHITECTURE&nbsp;4096</tt>" on a Spartan-6 build
    produced two RAMB16's and one RAMB8, not the expected two RAMB18's.
    Changing the configuration command to "<tt>ARCHITECTURE&nbsp;2048*2</tt>"
    produced the desired results.  The following <tt>BMM</tt> extracted the two
    RAMB18 locations with the desired memory mapping:<br/><br/>
    <tt>ADDRESS_SPACE&nbsp;uc&nbsp;RAMB18&nbsp;WORD_ADDRESSING&nbsp;[0x0:0xFFF]<br/>
    &nbsp;&nbsp;BUS_BLOCK<br/>
    &nbsp;&nbsp;&nbsp;&nbsp;top_inst/uc_inst_Mram_s_opcodeMemory_0&nbsp;[0:8];<br/>
    &nbsp;&nbsp;END_BUS_BLOCK;<br/>
    &nbsp;&nbsp;BUS_BLOCK<br/>
    &nbsp;&nbsp;&nbsp;&nbsp;top_inst/uc_inst_Mram_s_opcodeMemory_1&nbsp;[0:8];<br/>
    &nbsp;&nbsp;END_BUS_BLOCK;<br/>
    END_ADDRESS_SPACE;<br/></tt><br/>
  <li>Add this file to the build process.<br/><br/>
    For a command-line build this is done by adding "<tt>-bm&nbsp;uc.bmm</tt>"
    to the argument list for ngdbuild.<br/><br/>
    When <tt>bitgen</tt> is run it will create a file named "<tt>uc_bd.bmm</tt>
    which will include the memory block address required to run
    <tt>data2mem</tt>.<br/><br/>
  <li>Perform the build and ensure that <tt>uc_bd.bmm</tt> has the address for
    the memory block.<br/><br/>
  <li>Run <tt>data2mem</tt> as follows, where "<tt>orig.bit</tt>" is the
    assumed name for the original bitstream generated by Xilinx' tools:<br/><br/>
    <tt>data2mem&nbsp;-bm&nbsp;uc_bd.bmm&nbsp;-bt&nbsp;orig.bit&nbsp;-bd&nbsp;uc.mem&nbsp;-o&nbsp;b&nbsp;new.bit;<br/></tt><br/>
  <li>Compare the original bitstream to the modified bitstream as follows to
    ensure this process worked.<br/><br/>
    <tt>data2mem&nbsp;-bm&nbsp;uc.bmm&nbsp;-bt&nbsp;orig.bit&nbsp;-d&nbsp;&gt;&nbsp;orig.dump;<br/>
    data2mem&nbsp;-bm&nbsp;uc.bmm&nbsp;-bt&nbsp;new.bit&nbsp;-d&nbsp;&gt;&nbsp;new.dump;<br/>
    diff&nbsp;orig.dump&nbsp;new.dump&nbsp;|&nbsp;less;<br/></tt><br/>
    The only differences other than file names and dates and such should be the
    initialization values for the memory block.<br/><br/>
    You can validate this process by using the original memory initialization
    file, in which case the above differences should be limited to the file
    name, data, etc., but not the memory contents.<br/><br/>
  </ol>
  If you didn't include the <tt>BMM</tt> file in the build process you can use
  <tt>fpga_editor</tt> to get the memory names and memory locations.  The
  command to invoke it is:<br/><br/>
  <tt>&nbsp;&nbsp;fpga_editor&nbsp;-r&nbsp;file.ncd&nbsp;file.pcf<br/></tt><br/>
  Then, under "<tt>Name&nbsp;Filter</tt>" type "<tt>*opcodeMemory*</tt>" and hit
  the <tt>ENTER</tt> key.
</body>
</html>
