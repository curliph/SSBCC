<html>
<title>
Memory Initialization
</title>
<body>
This file describes the contents of the memory intialization file and how to
use it for various vendor-specific tools.
<h1>Format</h1>
  Each line of the file consists of a hex address into which the values are to
  be stored and the corresponding value.  For SSBCC.9x8 these are 9-bit values.
<h1>Xilinx <tt>data2mem</tt></h1>
  <tt>data2mem</tt> is a tool for modifying the block ram initialization
  contents of bitstreams.  Using this tool allows the micro controller assembly
  code to be modified in the bitstream without rerunning the entire build
  process.<br/><br/>
  The following illustrates how to use <tt>data2mem</tt> using
  ISE&nbsp;14.5:<br/><br/>
  <ol>
  <li>Create a <tt>BMM</tt> file named "<tt>uc.bmm</tt>" for inclusion in the
    build process:<br/><br/>
    The file should look like the following.  The text
    "<tt>top_inst/uc_inst</tt>" needs to be modified to point to your
    instantiation of the micro controller.<br/><br/>
    <tt>ADDRESS_SPACE&nbsp;uc&nbsp;RAMB18&nbsp;[0x0:0x7FF]<br/>
    &nbsp;&nbsp;BUS_BLOCK<br/>
    &nbsp;&nbsp;&nbsp;&nbsp;top_inst/uc_inst/Mram_s_opcodeMemory&nbsp;[8:0];<br/>
    &nbsp;&nbsp;END_BUS_BLOCK;<br/>
    END_ADDRESS_SPACE;<br/></tt><br/>
  <li>Add this file to the build process.<br/><br/>
    For a command-line build this is done by adding "<tt>-bm&nbsp;uc.bmm</tt>"
    to the argument list for ngdbuild.<br/><br/>
    When <tt>bitgen</tt> is run it will create a file named "<tt>uc_bd.bmm</tt>
    which will include the memory block address required to run
    <tt>data2mem</tt>.<br/><br/>
  <li>Perform the build and ensure that <tt>uc_bd.bmm</tt> has the address for
    the memory block.<br/><br/>
  <li>Create the following <tt>gawk</tt> script and call it
    <tt>update_uc.awk</tt>.<br/><br/>
    Experimentation with <tt>data2mem</tt> revealed that for 9-bit wide
    memories every 9'th memory location starting with address&nbsp;0 is
    reserved for the parity bits.<br/><br/>
    <tt>NF==2&nbsp;{<br/>
    &nbsp;&nbsp;addr&nbsp;=&nbsp;strtonum("0x"&nbsp;$1);<br/>
    &nbsp;&nbsp;addr&nbsp;+=&nbsp;int(addr/8+1);<br/>
    &nbsp;&nbsp;printf("@%04X&nbsp;%s\n",&nbsp;addr,&nbsp;$2);<br/>
    }<br/></tt><br/>
  <li>Convert the memory intialization file to the <tt>data2mem</tt> format as
    follows:<br/><br/>
    <tt>gawk&nbsp;-f&nbsp;update_uc.awk&nbsp;uc.mem&nbsp;&gt;&nbsp;new.mem;</tt><br/><br/>
  <li>Run <tt>data2mem</tt> as follows, where "<tt>orig.bit</tt>" is the
    assumed name for the original bitstream generated by Xilinx' tools:<br/><br/>
    <tt>data2mem&nbsp;-bm&nbsp;uc_bd.bmm&nbsp;-bt&nbsp;orig.bit&nbsp;-bd&nbsp;new.mem&nbsp;-o&nbsp;b&nbsp;new.bit;<br/></tt><br/>
  <li>Compare the original bitstream to the modified bitstream as follows to
    ensure this process worked.<br/><br/>
    <tt>data2mem&nbsp;-bm&nbsp;uc.bmm&nbsp;-bt&nbsp;orig.bit&nbsp;-d&nbsp;&gt;&nbsp;orig.dump;<br/>
    data2mem&nbsp;-bm&nbsp;uc.bmm&nbsp;-bt&nbsp;new.bit&nbsp;-d&nbsp;&gt;&nbsp;new.dump;<br/>
    diff&nbsp;orig.dump&nbsp;new.dump&nbsp;|&nbsp;less;<br/></tt><br/>
    The only differences other than file names and dates and such should be the
    initialization values for the memory block.<br/><br/>
    You can validate this process by using the original memory initialization
    file, in which case the above differences should be limited to the file
    name, data, etc., but not the memory contents.<br/><br/>
  </ol>
  If you didn't include the <tt>BMM</tt> file in the build process, the memory
  address can be extracted from the file <tt>orig.dump</tt> created by the last
  step in the above procedure.  The middle line of the <tt>BMM</tt> then needs
  to be replaced with something like the following:<br/><br/>
  <tt>top_inst/uc_inst/Mram_s_opcodeMemory&nbsp;RAMB18&nbsp;[8:0]&nbsp;[0:2047]&nbsp;PLACED&nbsp;=&nbsp;X3Y44;<br/></tt><br/>
</body>
</html>
